!function(m){"use strict";var o=function(i,t){this.$element=m(i),this.originalPosition={},this.originalElement={},this.$body=m("html body"),this.$doc=m(document),r(o.Defaults,t),this.options=m.extend({},o.Defaults,t),d(this.options,t),this.currentDialog="",this.currentDialogID="",this.init()};o.Version="1.1.0",o.Defaults={title:"Dialog",width:470,height:220,minWidth:150,minHeight:150,closeOnEscape:!0,resizable:!0,draggable:!0,autoOpen:!0,menus:[{text:"munu1",type:"nmenu",subMenus:[{text:"submenu1",fn:function(){}}],fn:function(){}}],statusBar:[{halign:"left",text:"",index:0,initValue:"",initText:""}],buttons:[{text:"btn1",fn:function(){}}],close:function(i){}},o.prototype.init=function(){var i=this,t=(i.options,"JDialog_"+a(i));i.currentDialogID=t,l(i),e(i),n(i),u(i)},o.prototype.show=function(){var i=.5*m(window).width()-.5*this.currentDialog.width(),t=.5*m(window).height()-.5*this.currentDialog.height();t=100<t?56:t,this.currentDialog.css({left:i,top:t}),this.$body.append("<div class='JDialog-backdrop'></div>"),this.$body.addClass("JDialog-open"),this.currentDialog.show(),this.currentDialog.focus(),v(this)},o.prototype.hide=function(){this.currentDialog.hide(),this.$body.find(".JDialog-backdrop").remove(),this.$body.removeClass("JDialog-open")},o.prototype.destroy=function(){var i,t=this.originalPosition;(i=t.parent.children().eq(t.index)).length&&i[0]!==this.originalElement[0]?i.before(this.originalElement):t.parent.append(this.originalElement),this.currentDialog.remove(),this.$body.find(".JDialog-backdrop").remove(),this.$body.removeClass("JDialog-open")},o.prototype.updateStatusBar=function(i){var l=this.options.statusBar,t=m("div.JDialog-statusbar ul.JDialog-statusbar-list li.JDialog-statusbar-item");m.each(i,function(i,o){t.each(function(i,t){var e=m(t);if(e.is("[data-index='"+o.index+"']")){var a=e.attr("data-origintext"),n=o.text.join(",");if(/\{(\d+)\}/g.test(a))n=a.replace(/\{(\d+)\}/g,function(i,t){return t=parseInt(t),o.text[t]});e.find("span").eq(0).text(n),m.grep(l,function(i,t){return i.index==o.index})[0].text=n}})})};var e=function(i){var t=i.options,e=[],a=t.width;a=a<t.minWidth?t.minWidth:a;var n=t.height;if(n=n<t.minHeight?t.minHeight:n,e.push(c("<div id='{0}' class='JDialog' tabindex='-1' style='display:none;'>",i.currentDialogID)),e.push(c("<div class='JDialog-dialog' style='width:{0};height:{1}'>",a+"px",n+"px")),e.push(c("<div class='JDialog-resizable-handle {0}'></div>",t.resizable?"JDialog-resizable-n":"")),e.push(c("<div class='JDialog-resizable-handle {0}'></div>",t.resizable?"JDialog-resizable-e":"")),e.push(c("<div class='JDialog-resizable-handle {0}'></div>",t.resizable?"JDialog-resizable-s":"")),e.push(c("<div class='JDialog-resizable-handle {0}'></div>",t.resizable?"JDialog-resizable-w":"")),e.push(c("<div class='JDialog-resizable-handle {0}'></div>",t.resizable?"JDialog-resizable-se":"")),e.push(c("<div class='JDialog-resizable-handle {0}'></div>",t.resizable?"JDialog-resizable-sw":"")),e.push("<div class='JDialog-content'>"),e.push("<div class='JDialog-header'>"),e.push("<div class='JDialog-left-header'>"),e.push(c("<h4 class='JDialog-title'>{0}</h4>",t.title)),e.push("</div>"),e.push("<div class='JDialog-right-header'>"),e.push("<ul class='JDialog-header-buttons'>"),e.push("<li class='JDialog-header-button-item'><button type='button' class='JDialog-scaling JDialog-maximize'></button></li>"),e.push("<li class='JDialog-header-button-item'><button type='button' class='close'><span>Ã—</span></button></li>"),e.push("</ul>"),e.push("</div>"),e.push("<div style='clear:both;'></div>"),e.push("</div>"),0<t.menus.length){e.push("<div class='JDialog-menu'>"),e.push("<ul class='JDialog-menu-list'>");for(var o=0;o<t.menus.length;o++){var l=[],s=t.menus[o];switch(s.type){case"nmenu":e.push(c("<li class='JDialog-menu-item' data-index='{1}'><div class='nmenu'><a class='btn btn-default'><span>{0}</span></a></div></li>",s.text,o));break;case"ddmenu":if(0<s.subMenus.length){l.push("<ul class='JDialog-submenu-list'>");for(var r=0;r<s.subMenus.length;r++){var u=s.subMenus[r],g=o.toString()+"-"+r.toString();l.push(c("<li class='JDialog-submenu-item' data-index='{1}'><a>{0}</a></li>",u.text,g))}l.push("</ul>")}e.push(c("<li class='JDialog-menu-item' data-index='{1}'><div class='ddmenu'><a class='btn btn-default'><span>{0}</span><span class='caret'></span></a></div>{2}</li>",s.text,o,l.join("")));break;case"sddmenu":if(0<s.subMenus.length){l.push("<ul class='JDialog-submenu-list'>");for(r=0;r<s.subMenus.length;r++){u=s.subMenus[r],g=o.toString()+"-"+r.toString();l.push(c("<li class='JDialog-submenu-item' data-index='{1}'><a>{0}</a></li>",u.text,g))}l.push("</ul>")}e.push(c("<li class='JDialog-menu-item' data-index='{1}'><div class='sddmenu'><a class='btn btn-default'><span>{0}</span></a>|<a class='btn btn-default'><span class='caret'></span></a></div>{2}</li>",s.text,o,l.join("")))}}e.push("</ul>"),e.push("</div>")}if(e.push("<div class='JDialog-body'>"),e.push(i.$element.clone().show().prop("outerHTML")),e.push("</div>"),0<t.statusBar.length){e.push("<div class='JDialog-statusbar'>");var d=m.grep(t.statusBar,function(i,t){return"left"==i.halign}),h=m.grep(t.statusBar,function(i,t){return"right"==i.halign});0<d.length&&(e.push("<div class='JDialog-left-statusbar'><ul class='JDialog-statusbar-list'>"),m.each(d,function(i,t){e.push(c("<li class='JDialog-statusbar-item' data-index='{2}' data-origintext='{0}'><span>{1}</span></li>",t.initText,t.initValue,t.index))}),e.push("</ul></div>")),0<h.length&&(e.push("<div class='JDialog-right-statusbar'><ul class='JDialog-statusbar-list'>"),m.each(h,function(i,t){e.push(c("<li class='JDialog-statusbar-item' data-index='{2}' data-origintext='{0}'><span>{1}</span></li>",t.initText,t.initValue,t.index))}),e.push("</ul></div>")),e.push("<div style='clear:both;'></div>"),e.push("</div>")}0<t.buttons.length&&(e.push("<div class='JDialog-footer'>"),m.each(t.buttons,function(i,t){e.push(c("<button class='btn btn-default' data-index='{1}'>{0}</button>",t.text,i))}),e.push("</div>")),e.push("</div>"),e.push("</div>"),e.push("</div>"),i.$body.append(e.join("")),i.originalPosition={parent:i.$element.parent(),index:i.$element.parent().children().index(i.$element)},i.originalElement=i.$element.clone(),i.$element.remove(),i.currentDialog=m("#"+i.currentDialogID),i.$element=i.currentDialog.find(".JDialog-content .JDialog-body").children().eq(0)},a=function(i){var t=i.$body.children(".JDialog"),n=[];return t.each(function(i,t){var e=m(t),a=parseInt(e.attr("id").replace("JDialog_",""));n.push(a)}),(n.length?s(n):0)+1},u=function(p){var J=p.options;J.draggable?p.currentDialog.find(".JDialog-header").off(".JDialog").on({"mouseover.JDialog":function(){m(this).css("cursor","move")},"mousedown.JDialog":function(i){var t=!0,e=i.pageX-m(this).parent().offset().left,a=i.pageY-m(this).parent().offset().top;p.$doc.on({"mousemove.JDialog":function(i){t&&p.currentDialog.offset({left:i.pageX-e,top:i.pageY-a})},"mouseup.JDialog":function(){t=!1,p.$doc.off(".JDialog")}})}}):(p.$doc.off(".JDialog"),p.currentDialog.find(".JDialog-header").off(".JDialog").css("cursor","default")),J.resizable?(p.currentDialog.find(".JDialog-dialog .JDialog-resizable-handle").show(),p.currentDialog.find(".JDialog-dialog .JDialog-resizable-handle").off(".JDialog").on("mousedown.JDialog",function(i){var a,n,o,l,s,r,u,g,d,h,c,D=m(this),f=D.attr("class").split(" ")[1].split("-")[2];h=!0,l=D.parent(".JDialog-dialog").offset().top,n=i.pageY,s=D.parent(".JDialog-dialog").outerHeight(),d=D.parent(".JDialog-dialog").offset().left,g=i.pageX,c=D.parent(".JDialog-dialog").outerWidth(),p.$doc.on({"mousemove.JDialog":function(i){if(h)switch(a=i.pageY,r=i.pageX,u=r-g,o=a-n,f){case"n":t=(t=s-o)<J.minHeight?J.minHeight:t,D.parent(".JDialog-dialog").height(t+"px"),D.parents(".JDialog").css("top",l+s-t+"px"),v(p);break;case"e":e=(e=c+u)<J.minWidth?J.minWidth:e,D.parent(".JDialog-dialog").width(e+"px");break;case"s":t=(t=s+o)<J.minHeight?J.minHeight:t,D.parent(".JDialog-dialog").height(t+"px"),v(p);break;case"w":e=(e=c-u)<J.minWidth?J.minWidth:e,D.parent(".JDialog-dialog").width(e+"px"),D.parents(".JDialog").css("left",d+(c-e)+"px");break;case"se":e=(e=c+u)<J.minWidth?J.minWidth:e,t=(t=s+o)<J.minHeight?J.minHeight:t,D.parent(".JDialog-dialog").width(e+"px"),D.parent(".JDialog-dialog").height(t+"px"),v(p);break;case"sw":var t,e;t=(t=s+o)<J.minHeight?J.minHeight:t,e=(e=c-u)<J.minWidth?J.minWidth:e,D.parent(".JDialog-dialog").width(e+"px"),D.parent(".JDialog-dialog").height(t+"px"),D.parents(".JDialog").css("left",d+(c-e)+"px"),v(p)}},"mouseup.JDialog":function(i){h=!1,i.preventDefault(),i.stopPropagation(),p.$doc.off(".JDialog")}})})):(p.$doc.off(".JDialog"),p.currentDialog.find(".JDialog-dialog .JDialog-resizable-handle").hide().off(".JDialog"))},n=function(o){var e,l=o.options,s=l.resizable,r=l.draggable;o.currentDialog.find("div.JDialog-content div.JDialog-header ul.JDialog-header-buttons button.close").off(".JDialog").on("click.JDialog",function(i){o.hide(),l.close&&"function"==typeof l.close&&l.close(i)}),o.currentDialog.find("div.JDialog-content div.JDialog-header ul.JDialog-header-buttons button.JDialog-scaling").off(".JDialog").on("click.JDialog",function(i){var t=m(this),e=o.options;if(t.hasClass("JDialog-maximize")){var a=m(window);t.removeClass("JDialog-maximize").addClass("JDialog-restore"),s&&(e.resizable=!1),r&&(e.draggable=!1);var n=g(o);t.attr("data-area",n),o.currentDialog.offset({left:a.scrollLeft(),top:a.scrollTop()}),o.currentDialog.children(".JDialog-dialog").width(a.width()).height(a.height()-3),v(o),u(o)}else if(t.hasClass("JDialog-restore")){t.removeClass("JDialog-restore").addClass("JDialog-maximize"),s&&(e.resizable=!0),r&&(e.draggable=!0);n=t.attr("data-area").split(",");o.currentDialog.offset({left:n[3],top:n[2]}),o.currentDialog.children(".JDialog-dialog").width(n[0]).height(n[1]),v(o),u(o)}}),o.currentDialog.find("div.JDialog-content div.JDialog-footer button").off(".JDialog").on("click.JDialog",function(){var e=m(this).attr("data-index");m.grep(l.buttons,function(i,t){if(t==e)return!0},!1)[0].fn(this,event)}),o.currentDialog.off(".JDialog").on("keydown.JDialog",function(i){l.closeOnEscape&&27==i.keyCode&&(o.hide(),l.close&&"function"==typeof l.close&&l.close(event))}),o.currentDialog.find("div.JDialog-content div.JDialog-menu a.btn").off("click.JDialog").on("click.JDialog",function(){var i=m(this);if(!(i.parents().is(".ddmenu")||i.parents().is(".sddmenu")&&i.children().is(".caret"))){var e=i.parents("li.JDialog-menu-item").attr("data-index");m.grep(l.menus,function(i,t){if(t==e)return!0},!1)[0].fn(this,event)}}),o.currentDialog.find("div.JDialog-content div.JDialog-menu ul.JDialog-submenu-list li.JDialog-submenu-item a").off("click.JDialog").on("click.JDialog",function(){var i=m(this);o.currentDialog.find("div.JDialog-content div.JDialog-menu ul.JDialog-submenu-list").hide();var t=i.parents("li.JDialog-submenu-item").attr("data-index").split("-"),e=t[0],a=t[1],n=m.grep(l.menus,function(i,t){if(t==e)return!0},!1);(n=m.grep(n[0].subMenus,function(i,t){if(t==a)return!0},!1))[0].fn(this,event)}),o.currentDialog.find("div.JDialog-content div.JDialog-menu a.btn").off(".show.JDialog").on({"mouseenter.show.JDialog":function(){var i=m(this);if(o.currentDialog.find("div.JDialog-content div.JDialog-menu ul.JDialog-submenu-list").hide(),i.parents().is(".ddmenu")||i.parents().is(".sddmenu")&&i.children().is(".caret")){var t=i.parents("li.JDialog-menu-item").find("ul.JDialog-submenu-list");0<t.find("li.JDialog-submenu-item").length&&(e&&(clearTimeout(e),e=!1),t.show())}},"mouseleave.show.JDialog":function(){var i=m(this);if(i.parents().is(".ddmenu")||i.parents().is(".sddmenu")&&i.children().is(".caret")){var t=i.parents("li.JDialog-menu-item").find("ul.JDialog-submenu-list");0<t.find("li.JDialog-submenu-item").length&&(e&&(clearTimeout(e),e=!1),e=setTimeout(function(){t.hide()},300))}}}),o.currentDialog.find("div.JDialog-content div.JDialog-menu ul.JDialog-submenu-list").off(".show.JDialog").on({"mouseenter.show.JDialog":function(){var i=m(this);e&&(clearTimeout(e),e=!1),i.show()},"mouseleave.show.JDialog":function(){var i=m(this);e&&(clearTimeout(e),e=!1),e=setTimeout(function(){i.hide()},300)}})},v=function(i){i.options;var t=(i.currentDialog.find(".JDialog-dialog").height()-(i.currentDialog.find(".JDialog-body").outerHeight()-i.currentDialog.find(".JDialog-body").height())-i.currentDialog.find(".JDialog-header").outerHeight()-i.currentDialog.find(".JDialog-menu").outerHeight()-i.currentDialog.find(".JDialog-statusbar").outerHeight()-i.currentDialog.find(".JDialog-footer").outerHeight()).toString()+"px";i.currentDialog.find(".JDialog-body").height(t)},g=function(i){var t,e=i.currentDialog.find(".JDialog-dialog");return t=e.height(),[e.width(),t,e.offset().top,e.offset().left]};var r=function(i,t){for(var e in t)if(t.hasOwnProperty(e)&&m.isArray(t[e])&&i.hasOwnProperty(e)){for(var a=[],n=t[e],o=0;o<n.length;o++){var l=n[o],s=m.extend(!0,{},i[e][0],l);d(s,l),a.push(s)}t[e]=a}else m.isPlainObject(t[e])&&r(i[e],t[e])},d=function(i,t){for(var e in i)i.hasOwnProperty(e)&&m.isArray(i[e])&&!t.hasOwnProperty(e)?i[e]=[]:m.isPlainObject(i[e])&&d(i[e],t[e])},l=function(i){var t=i.options;0<t.statusBar.length&&m.each(t.statusBar,function(i,t){var e="",a="",n=/\{(\d+)(=([\u4e00-\u9fa5_a-zA-Z0-9]+))?\}/g;n.test(t.text)?(e=t.text.replace(n,function(i,t,e,a){return void 0===a?"":a}),a=t.text.replace(n,function(i,t,e,a){return"{"+t+"}"})):e=a=t.text,t.index=i,t.initValue=e,t.initText=a})},s=function(i){for(var t=i[0],e=i.length,a=1;a<e;a++)i[a]>t&&(t=i[a]);return t},c=function(i){var e=arguments;return i.replace(/\{(\d+)\}/g,function(i,t){return t=parseInt(t),e[t+1]})},i=m.fn.jDialog;m.fn.jDialog=function(a,n){return this.each(function(){var i,t=m(this),e="object"==typeof a&&a;(i=t.data("jDialog"))||(i=new o(this,e)).$element.data("jDialog",i);"string"==typeof a&&i&&i[a]?i[a](n):i.options.autoOpen&&i.show()})},m.fn.jDialog.Constructor=o,m.fn.jDialog.noConflict=function(){return m.fn.jDialog=i,this}}(jQuery);