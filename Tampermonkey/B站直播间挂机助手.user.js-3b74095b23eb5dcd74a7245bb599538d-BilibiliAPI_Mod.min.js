// ==UserScript==
// @name          BilibiliAPI_mod
// @namespace     https://github.com/SeaLoong
// @version       3.0.9
// @description   BilibiliAPI，PC端抓包研究所得，原作者是SeaLoong。我在此基础上补充新的API。
// @author        SeaLoong, andywang425
// @require       https://code.jquery.com/jquery-3.6.0.min.js
// @grant         none
// @include       *
// @license       MIT
// ==/UserScript==
let BAPI_csrf_token,BAPI_visit_id,BAPI_ts_ms=()=>Date.now(),BAPI_ts_s=()=>Math.round(BAPI_ts_ms()/1e3);var BAPI={setCommonArgs:(e="",a="")=>{BAPI_csrf_token=e,BAPI_visit_id=a},TreasureBox:{getAward:(e,a,t)=>BAPI.lottery.SilverBox.getAward(e,a,t),getCaptcha:e=>BAPI.lottery.SilverBox.getCaptcha(e),getCurrentTask:()=>BAPI.lottery.SilverBox.getCurrentTask()},Exchange:{coin2silver:(e,a)=>BAPI.pay.coin2silver(e,a),silver2coin:e=>BAPI.pay.silver2coin(e),old:{coin2silver:e=>BAPI.exchange.coin2silver(e),silver2coin:()=>BAPI.exchange.silver2coin()}},Lottery:{Gift:{check:e=>BAPI.xlive.smalltv.check(e),join:(e,a,t)=>BAPI.xlive.smalltv.join(e,a,t),notice:(e,a)=>BAPI.xlive.smalltv.notice(e,a)},Raffle:{check:e=>BAPI.activity.check(e),join:(e,a)=>BAPI.activity.join(e,a),notice:(e,a)=>BAPI.activity.notice(e,a)},MaterialObject:{getRoomActivityByRoomid:e=>BAPI.lottery.box.getRoomActivityByRoomid(e),getStatus:(e,a)=>BAPI.lottery.box.getStatus(e,a),draw:(e,a)=>BAPI.lottery.box.draw(e,a),getWinnerGroupInfo:(e,a)=>BAPI.lottery.box.getWinnerGroupInfo(e,a)},Guard:{check:e=>BAPI.lottery.lottery.check_guard(e),join:(e,a,t)=>BAPI.xlive.guard.join(e,a,t)},Pk:{check:e=>BAPI.xlive.pk.check(e),join:(e,a)=>BAPI.xlive.pk.join(e,a)}},Group:{my_groups:()=>BAPI.link_group.my_groups(),sign_in:(e,a)=>BAPI.link_group.sign_in(e,a)},Storm:{check:e=>BAPI.lottery.Storm.check(e),join:(e,a,t,i,r)=>BAPI.lottery.Storm.join(e,a,t,i,r),join_ex:(e,a,t,i,r,o="",n="",l=16777215)=>BAPI.lottery.Storm.join_ex(e,a,t,i,r,"","",16777215)},HeartBeat:{web:()=>BAPI.user.userOnlineHeart(),mobile:()=>BAPI.mobile.userOnlineHeart()},DailyReward:{task:()=>BAPI.home.reward(),exp:()=>BAPI.exp(),login:()=>BAPI.x.now(),watch:(e,a,t,i,r,o,n,l,s)=>BAPI.x.heartbeat(e,a,t,i,r,o,n,l,s),coin:(e,a)=>BAPI.x.coin_add(e,a),share:e=>BAPI.x.share_add(e)},ajax:e=>{void 0===e.xhrFields&&(e.xhrFields={}),e.xhrFields.withCredentials=!0,jQuery.extend(e,{url:("//"===e.url.substr(0,2)||"http"===e.url.substr(0,4)?"":"//api.live.bilibili.com/")+e.url,method:e.method||"GET",crossDomain:!0,dataType:e.dataType||"json"});const a=jQuery.Deferred();return jQuery.ajax(e).then(((...e)=>{a.resolve(...e)})).catch((e=>{e.responseJSON?e.responseJSON.msg=e.responseJSON.message:0!==e.status?e.responseJSON={code:e.status,message:`状态码: ${e.status}`,msg:`状态码: ${e.status}`}:e.responseJSON={code:"NET_ERR",msg:"请检查网络",message:"请检查网络"},e.responseJSON.netError=!0,a.resolve(e.responseJSON)})),a},ajaxWithCommonArgs:e=>(e.data||(e.data={}),e.data.csrf=BAPI_csrf_token,e.data.csrf_token=BAPI_csrf_token,void 0!==BAPI_visit_id&&(e.data.visit_id=BAPI_visit_id),BAPI.ajax(e)),ajaxGetCaptchaKey:()=>BAPI.ajax({url:"//www.bilibili.com/plus/widget/ajaxGetCaptchaKey.php?js"}),exp:()=>BAPI.ajax({url:"//www.bilibili.com/plus/account/exp.php"}),msg:e=>BAPI.ajaxWithCommonArgs({method:"POST",url:"ajax/msg",data:{roomid:e}}),ajaxCapsule:()=>BAPI.ajax({url:"api/ajaxCapsule"}),player:(e,a,t="pc",i="web")=>BAPI.ajax({url:"api/player",data:{id:"string"==typeof e&&"cid:"===e.substr(0,4)?e:"cid:"+e,ts:"string"==typeof a?a:a.toString(16),platform:t,player_type:i},dataType:"text"}),create:(e,a)=>BAPI.ajax({url:"captcha/v1/Captcha/create",data:{width:e||"112",height:a||"32"},cache:!1}),topList:(e,a,t)=>BAPI.ajax({url:"guard/topList",data:{roomid:e,page:a,ruid:t}}),getSuser:()=>BAPI.ajax({url:"msg/getSuser"}),refresh:(e="all")=>BAPI.ajax({url:"index/refresh?area="+e}),get_ip_addr:()=>BAPI.ajax({url:"ip_service/v1/ip_service/get_ip_addr"}),getuserinfo:()=>BAPI.ajax({url:"user/getuserinfo"}),activity:{mobileActivity:()=>BAPI.ajax({url:"activity/v1/Common/mobileActivity"}),mobileRoomInfo:e=>BAPI.ajax({url:"activity/v1/Common/mobileRoomInfo",data:{roomid:e}}),roomInfo:(e,a,t,i)=>BAPI.ajax({url:"activity/v1/Common/roomInfo",data:{roomid:e,ruid:a,area_v2_id:t,area_v2_parent_id:i}}),welcomeInfo:(e,a)=>BAPI.ajax({url:"activity/v1/Common/welcomeInfo",data:{roomid:e,ruid:a}}),check:e=>BAPI.ajax({url:"activity/v1/Raffle/check?roomid="+e}),join:(e,a)=>BAPI.ajax({url:"activity/v1/Raffle/join",data:{roomid:e,raffleId:a}}),notice:(e,a)=>BAPI.ajax({url:"activity/v1/Raffle/notice",data:{roomid:e,raffleId:a}}),receive_award:e=>BAPI.ajaxWithCommonArgs({method:"POST",url:"activity/v1/task/receive_award",data:{task_id:e}})},av:{getTimestamp:(e="pc")=>BAPI.ajaxWithCommonArgs({method:"POST",url:"av/v1/Time/getTimestamp",data:{platform:e}})},dynamic_svr:{dynamic_new:(e,a=8)=>BAPI.ajax({url:"dynamic_svr/v1/dynamic_svr/dynamic_new",data:{uid:e,type:a}}),space_history:(e,a,t,i)=>BAPI.ajax({url:"dynamic_svr/v1/dynamic_svr/space_history",data:{visitor_uid:e,host_uid:a,offset_dynamic_id:t,need_top:i}}),w_live_users:(e=10)=>BAPI.ajax({url:"//api.vc.bilibili.com/dynamic_svr/v1/dynamic_svr/w_live_users",data:{size:e}})},exchange:{coin2silver:e=>BAPI.ajax({method:"POST",url:"exchange/coin2silver",data:{coin:e}}),silver2coin:()=>BAPI.ajax({type:"GET",url:"exchange/silver2coin"})},fans_medal:{get_fans_medal_info:(e,a,t=1)=>BAPI.ajaxWithCommonArgs({method:"POST",url:"fans_medal/v1/fans_medal/get_fans_medal_info",data:{source:t,uid:e,target_id:a}})},feed_svr:{notice:()=>BAPI.ajaxWithCommonArgs({method:"POST",url:"feed_svr/v1/feed_svr/notice",data:{}}),my:(e,a=0,t=0,i=0)=>BAPI.ajaxWithCommonArgs({method:"POST",url:"feed_svr/v1/feed_svr/my",data:{live_status:a,type:t,page_size:e,offset:i}})},gift:{bag_list:()=>BAPI.ajax({url:"gift/v2/gift/bag_list"}),send:(e,a,t,i,r,o,n="silver",l="pc",s="live",d=0,m=0)=>BAPI.ajaxWithCommonArgs({method:"POST",url:"gift/v2/gift/send",data:{uid:e,gift_id:a,ruid:t,gift_num:i,coin_type:n,bag_id:0,platform:l,biz_code:s,biz_id:r,rnd:o,storm_beat_id:d,metadata:"",price:m}}),bag_send:(e,a,t,i,r,o,n,l="pc",s="live",d=0,m=0)=>BAPI.ajaxWithCommonArgs({method:"POST",url:"gift/v2/live/bag_send",data:{uid:e,gift_id:a,ruid:t,gift_num:i,bag_id:r,platform:l,biz_code:s,biz_id:o,rnd:n,storm_beat_id:d,metadata:"",price:m}}),gift_config:()=>BAPI.ajax({url:"gift/v3/live/gift_config"}),heart_gift_receive:(e,a)=>BAPI.ajax({url:"gift/v2/live/heart_gift_receive",data:{roomid:e,area_v2_id:a}}),heart_gift_status:(e,a)=>BAPI.ajax({url:"gift/v2/live/heart_gift_status",data:{roomid:e,area_v2_id:a}}),receive_daily_bag:()=>BAPI.ajax({url:"gift/v2/live/receive_daily_bag"}),room_gift_list:(e,a)=>BAPI.ajax({url:"gift/v2/live/room_gift_list",data:{roomid:e,area_v2_id:a}}),smalltv:{check:e=>BAPI.ajax({url:"gift/v3/smalltv/check",data:{roomid:e}}),join:(e,a,t="Gift")=>BAPI.ajaxWithCommonArgs({method:"POST",url:"gift/v3/smalltv/join",data:{roomid:e,raffleId:a,type:t}}),notice:(e,a="small_tv")=>BAPI.ajax({url:"gift/v3/smalltv/notice",data:{type:a,raffleId:e}})}},giftBag:{getSendGift:()=>BAPI.ajax({url:"giftBag/getSendGift"}),sendDaily:()=>BAPI.ajax({url:"giftBag/sendDaily"})},home:{reward:()=>BAPI.ajax({url:"//account.bilibili.com/home/reward"})},i:{ajaxCancelWear:()=>BAPI.ajax({url:"i/ajaxCancelWear"}),ajaxGetAchieve:(e,a,t=6,i="normal",r=0,o="all")=>BAPI.ajax({url:"i/api/ajaxGetAchieve",data:{type:i,status:r,category:o,keywords:e,page:a,pageSize:t}}),ajaxGetMyMedalList:()=>BAPI.ajax({url:"i/ajaxGetMyMedalList"}),ajaxWearFansMedal:e=>BAPI.ajax({url:"i/ajaxWearFansMedal?medal_id="+e}),following:(e=1,a=9)=>BAPI.ajax({url:"i/api/following",data:{page:e,pageSize:a}}),guard:(e,a=10)=>BAPI.ajax({url:"i/api/guard",data:{page:e,pageSize:a}}),liveinfo:()=>BAPI.ajax({url:"i/api/liveinfo"}),medal:(e=1,a=10)=>BAPI.ajax({url:"i/api/medal",data:{page:e,pageSize:a}}),operation:(e=1)=>BAPI.ajax({url:"i/api/operation?page="+e}),taskInfo:()=>BAPI.ajax({url:"i/api/taskInfo"})},link_group:{my_groups:()=>BAPI.ajax({url:"link_group/v1/member/my_groups"}),sign_in:(e,a)=>BAPI.ajax({url:"link_setting/v1/link_setting/sign_in",data:{group_id:e,owner_id:a}}),buy_medal:(e,a="metal",t="android")=>BAPI.ajaxWithCommonArgs({method:"POST",url:"//api.vc.bilibili.com/link_group/v1/member/buy_medal",data:{master_uid:e,coin_type:a,platform:t}})},live:{getRoomKanBanModel:e=>BAPI.ajax({url:"live/getRoomKanBanModel?roomid"+e}),rankTab:e=>BAPI.ajax({url:"live/rankTab?roomid="+e}),roomAdList:()=>BAPI.ajax({url:"live/roomAdList"})},live_user:{get_anchor_in_room:e=>BAPI.ajax({url:"live_user/v1/UserInfo/get_anchor_in_room?roomid="+e}),get_info_in_room:e=>BAPI.ajax({url:"live_user/v1/UserInfo/get_info_in_room?roomid="+e}),get_weared_medal:(e,a,t=1)=>BAPI.ajaxWithCommonArgs({method:"POST",url:"live_user/v1/UserInfo/get_weared_medal",data:{source:t,uid:e,target_id:a}}),governorShow:e=>BAPI.ajax({url:"live_user/v1/Master/governorShow?target_id="+e})},lottery:{box:{getRoomActivityByRoomid:e=>BAPI.ajax({url:"lottery/v1/box/getRoomActivityByRoomid?roomid="+e}),getStatus:(e,a="")=>BAPI.ajax({url:"lottery/v2/box/getStatus",data:{aid:e,times:a}}),draw:(e,a=1)=>BAPI.ajax({url:"/xlive/lottery-interface/v2/Box/draw",data:{aid:e,number:a}}),getWinnerGroupInfo:(e,a=1)=>BAPI.ajax({url:"lottery/v2/box/getWinnerGroupInfo",data:{aid:e,number:a}})},SilverBox:{getAward:(e,a,t)=>BAPI.ajax({url:"lottery/v1/SilverBox/getAward",data:{time_start:e,end_time:a,captcha:t}}),getCaptcha:e=>BAPI.ajax({url:"lottery/v1/SilverBox/getCaptcha?ts="+e}),getCurrentTask:()=>BAPI.ajax({url:"lottery/v1/SilverBox/getCurrentTask"})},Storm:{check:e=>BAPI.ajax({url:"lottery/v1/Storm/check?roomid="+e}),join:(e,a,t,i,r=16777215)=>BAPI.ajaxWithCommonArgs({method:"POST",url:"lottery/v1/Storm/join",data:{id:e,color:r,captcha_token:a,captcha_phrase:t,roomid:i}}),join_ex:(e,a,t,i,r)=>{let o=TokenUtil.signQuery(KeySign.sort({id:e,access_key:t,appkey:i,actionKey:"appkey",build:5561e3,channel:"bili",device:"android",mobi_app:"android",platform:"android"}));return BAPI.ajaxWithCommonArgs({method:"POST",url:`xlive/lottery-interface/v1/storm/Join?${o}`,headers:r,roomid:a})}},lottery:{check_guard:e=>BAPI.ajax({url:"lottery/v1/Lottery/check_guard?roomid="+e}),join:(e,a,t="guard")=>BAPI.ajaxWithCommonArgs({method:"POST",url:"lottery/v2/Lottery/join",data:{roomid:e,id:a,type:t}})}},mobile:{userOnlineHeart:()=>BAPI.ajaxWithCommonArgs({method:"POST",url:"mobile/userOnlineHeart",data:{}})},pay:{coin2silver:(e,a="pc")=>BAPI.ajaxWithCommonArgs({method:"POST",url:"pay/v1/Exchange/coin2silver",data:{num:e,platform:a}}),getRule:(e="pc")=>BAPI.ajax({url:"pay/v1/Exchange/getRule?platform="+e}),getStatus:(e="pc")=>BAPI.ajax({url:"pay/v1/Exchange/getStatus?platform="+e}),silver2coin:(e="pc")=>BAPI.ajaxWithCommonArgs({method:"POST",url:"pay/v1/Exchange/silver2coin",data:{platform:e}}),myWallet:(e=1,a=1,t="pc")=>BAPI.ajax({url:"pay/v2/Pay/myWallet",data:{need_bp:e,need_metal:a,platform:t}})},rankdb:{roomInfo:(e,a,t)=>BAPI.ajax({url:"rankdb/v1/Common/roomInfo",data:{ruid:e,roomid:a,areaId:t}}),getTopRealTimeHour:e=>BAPI.ajax({url:`rankdb/v1/Rank2018/getTop?type=master_realtime_hour&type_id=areaid_realtime_hour&area_id=${e}`})},relation:{getList:(e,a)=>BAPI.ajax({url:"relation/v1/feed/getList",data:{page:e,page_size:a},cache:!1}),heartBeat:()=>BAPI.ajax({url:"relation/v1/feed/heartBeat",cache:!1}),GetUserFc:e=>BAPI.ajax({url:"relation/v1/Feed/GetUserFc?follow="+e}),IsUserFollow:e=>BAPI.ajax({url:"relation/v1/Feed/IsUserFollow?follow="+e}),getFollowings:(e,a=1,t=20,i="desc",r="jsonp",o="")=>BAPI.ajax({url:"//api.bilibili.com/x/relation/followings",data:{vmid:e,pn:a,ps:t,order:i,jsonp:r,callback:o}}),get_attention_list:e=>BAPI.ajax({url:"//api.vc.bilibili.com/feed/v1/feed/get_attention_list",data:{mid:e}}),getTags:()=>BAPI.ajax({url:"//api.bilibili.com/x/relation/tags",data:{jsonp:"jsonp",callback:""}}),getUpInTag:(e,a,t=1,i=20,r="jsonp",o="")=>BAPI.ajax({url:"//api.bilibili.com/x/relation/tag",data:{mid:e,tagid:a,pn:t,ps:i,jsonp:r,callback:o}}),createTag:(e,a="jsonp")=>BAPI.ajaxWithCommonArgs({method:"POST",url:"//api.bilibili.com/x/relation/tag/create",data:{tag:e,jsonp:a}}),getTagIDByName:e=>BAPI.ajax({url:"//api.bilibili.com/x/tag/info",data:{tag_name:e}}),delTag:(e,a="jsonp")=>BAPI.ajaxWithCommonArgs({method:"POST",url:"//api.bilibili.com/x/relation/tag/del",data:{tagid:e,jsonp:a}}),modify:(e,a,t=11)=>BAPI.ajaxWithCommonArgs({method:"POST",url:"//api.bilibili.com/x/relation/modify",data:{fid:e,act:a,re_src:t,jsonp:"jsonp",callback:""}}),addUsers:(e,a,t=!0)=>BAPI.ajaxWithCommonArgs({method:"POST",url:"//api.bilibili.com/x/relation/tags/addUsers",data:{cross_domain:t,fids:e,tagids:a}}),moveUsers:(e,a,t,i="jsonp")=>BAPI.ajaxWithCommonArgs({method:"POST",url:"//api.bilibili.com/x/relation/tags/moveUsers",data:{beforeTagids:e,afterTagids:a,fids:t,jsonp:i}})},room:{get_info:(e,a="room")=>BAPI.ajax({url:"room/v1/Room/get_info",data:{room_id:e,from:a}}),get_recommend_by_room:(e,a,t)=>BAPI.ajax({url:"room/v1/room/get_recommend_by_room",data:{room_id:e,count:a,rnd:t||Math.floor(Date.now()/1e3)}}),playUrl:(e,a="0",t="web")=>BAPI.ajax({url:"room/v1/Room/playUrl",data:{cid:e,quality:a,platform:t}}),room_entry_action:(e,a="pc")=>BAPI.ajaxWithCommonArgs({method:"POST",url:"room/v1/Room/room_entry_action",data:{room_id:e,platform:a}}),room_init:e=>BAPI.ajax({url:"room/v1/Room/room_init?id="+e}),getConf:(e,a="pc",t="web")=>BAPI.ajax({url:"room/v1/Danmu/getConf",data:{room_id:e,platform:a,player:t}}),getList:()=>BAPI.ajax({url:"room/v1/Area/getList"}),getRoomList:(e=1,a=0,t=0,i=1,r=30,o="online",n="web",l=1)=>BAPI.ajax({url:"room/v3/area/getRoomList",data:{platform:n,parent_area_id:e,cate_id:a,area_id:t,sort_type:o,page:i,page_size:r,tag_version:l}}),update:(e,a)=>BAPI.ajaxWithCommonArgs({method:"POST",url:"room/v1/Room/update",data:{room_id:e,description:a}}),getRoomInfoOld:e=>BAPI.ajax({url:"room/v1/Room/getRoomInfoOld",data:{mid:e}}),getRoomBaseInfo:(e,a="link-center")=>BAPI.ajax({url:"xlive/web-room/v1/index/getRoomBaseInfo",data:{room_ids:e,req_biz:a}}),verify_room_pwd:(e,a="")=>BAPI.ajax({url:"room/v1/Room/verify_room_pwd",data:{room_id:e,pwd:a}})},sign:{doSign:()=>BAPI.ajax({url:"sign/doSign"}),GetSignInfo:()=>BAPI.ajax({url:"sign/GetSignInfo"}),getLastMonthSignDays:()=>BAPI.ajax({url:"sign/getLastMonthSignDays"})},user:{getWear:e=>BAPI.ajax({url:"user/v1/user_title/getWear?uid="+e}),isBiliVip:e=>BAPI.ajax({url:"user/v1/user/isBiliVip?uid="+e}),userOnlineHeart:()=>BAPI.ajaxWithCommonArgs({method:"POST",url:"User/userOnlineHeart",data:{}}),getUserInfo:e=>BAPI.ajax({url:"User/getUserInfo?ts="+e})},x:{getUserSpace:(e,a,t,i,r,o,n)=>BAPI.ajax({url:"//api.bilibili.com/x/space/arc/search",data:{mid:e,ps:a,tid:t,pn:i,keyword:r,order:o,jsonp:n}}),getAccInfo:(e,a="jsonp")=>BAPI.ajax({url:"//api.bilibili.com/x/space/acc/info",data:{mid:e,jsonp:a}}),getCoinInfo:(e,a,t,i)=>BAPI.ajax({url:"//api.bilibili.com/x/web-interface/archive/coins",data:{callback:e,jsonp:a,aid:t,_:i}}),getTodayExp:()=>BAPI.ajax({url:"//api.bilibili.com/x/web-interface/coin/today/exp"}),coin_add:(e,a=1,t=0)=>BAPI.ajaxWithCommonArgs({method:"POST",url:"//api.bilibili.com/x/web-interface/coin/add",data:{aid:e,multiply:a,select_like:t,cross_domain:!0}}),share_add:e=>BAPI.ajaxWithCommonArgs({method:"POST",url:"//api.bilibili.com/x/web-interface/share/add",data:{aid:e,jsonp:"jsonp"}}),heartbeat:(e,a,t,i,r=0,o=0,n=3,l=1,s=2)=>BAPI.ajaxWithCommonArgs({method:"POST",url:"//api.bilibili.com/x/report/web/heartbeat",data:{aid:e,cid:a,mid:t,start_ts:i||Date.now()/1e3,played_time:r,realtime:o,type:n,play_type:l,dt:s}}),now:()=>BAPI.ajax({url:"//api.bilibili.com/x/report/click/now",data:{jsonp:"jsonp"}}),card:e=>BAPI.ajax({url:"//api.bilibili.com/x/web-interface/card",data:{mid:e}}),stat:e=>BAPI.ajax({url:"//api.bilibili.com/x/relation/stat",data:{vmid:e}}),reserve:(e,a="jsonp")=>BAPI.ajaxWithCommonArgs({method:"POST",url:"//api.bilibili.com/x/space/reserve",data:{sid:e,jsonp:a}}),get_reserve_info:e=>BAPI.ajax({url:"https://api.bilibili.com/x/activity/up/reserve/relation/info",data:{ids:e}}),elec_pay_quick:(e,a=5,t="up",i=!0,r=e)=>BAPI.ajaxWithCommonArgs({method:"POST",url:"//api.bilibili.com/x/ugcpay/web/v2/trade/elec/pay/quick",data:{up_mid:e,bp_num:a,otype:t,is_bp_remains_prior:i,oid:r}}),activity:{getLotteryMyTimes:e=>BAPI.ajax({url:"//api.bilibili.com/x/activity/lottery/mytimes",data:{sid:e}}),doLottery:(e,a=1)=>BAPI.ajaxWithCommonArgs({method:"POST",url:"//api.bilibili.com/x/activity/lottery/do",data:{sid:e,type:a}}),addLotteryTimes:(e,a=3)=>BAPI.ajaxWithCommonArgs({method:"POST",url:"//api.bilibili.com/x/activity/lottery/addtimes",data:{sid:e,action_type:a}})},vip:{privilege:{my:()=>BAPI.ajax({url:"//api.bilibili.com/x/vip/privilege/my"}),receive:e=>BAPI.ajaxWithCommonArgs({method:"POST",url:"//api.bilibili.com/x/vip/privilege/receive",data:{type:e}})}}},xlive:{revenue:{silver2coin:()=>BAPI.ajaxWithCommonArgs({method:"POST",url:"xlive/revenue/v1/wallet/silver2coin"}),coin2silver:(e,a="pc")=>BAPI.ajaxWithCommonArgs({method:"POST",url:"xlive/revenue/v1/wallet/coin2silver",data:{num:e,platform:a}})},guard:{join:(e,a,t="guard")=>BAPI.ajaxWithCommonArgs({method:"POST",url:"xlive/lottery-interface/v3/guard/join",data:{roomid:e,id:a,type:t}})},lottery:{check:e=>BAPI.ajax({url:"xlive/lottery-interface/v1/lottery/Check",data:{roomid:e}}),gettLotteryInfoWeb:e=>BAPI.ajax({url:"xlive/lottery-interface/v1/lottery/getLotteryInfoWeb",data:{roomid:e}})},smalltv:{check:e=>BAPI.ajax({url:"xlive/lottery-interface/v3/smalltv/Check",data:{roomid:e}}),join:(e,a,t="small_tv")=>BAPI.ajaxWithCommonArgs({method:"POST",url:"xlive/lottery-interface/v5/smalltv/join",data:{roomid:e,id:a,type:t}}),notice:(e,a="small_tv")=>BAPI.ajax({url:"xlive/lottery-interface/v3/smalltv/Notice",data:{type:a,raffleId:e}})},pk:{check:e=>BAPI.ajax({url:"xlive/lottery-interface/v1/pk/check",data:{roomid:e}}),join:(e,a)=>BAPI.ajaxWithCommonArgs({method:"POST",url:"xlive/lottery-interface/v1/pk/join",data:{roomid:e,id:a}})},dosign:()=>BAPI.ajax({url:"xlive/web-ucenter/v1/sign/DoSign"}),getDanmuInfo:(e,a=0)=>BAPI.ajax({url:"xlive/web-room/v1/index/getDanmuInfo",data:{id:e,type:a}}),getInfoByUser:e=>BAPI.ajax({url:"xlive/web-room/v1/index/getInfoByUser",data:{room_id:e}}),wearMedal:e=>BAPI.ajaxWithCommonArgs({method:"POST",url:"xlive/web-room/v1/fansMedal/wear",data:{medal_id:e}}),getHotRank:(e,a,t=0,i,r,o)=>BAPI.ajax({url:"xlive/general-interface/v1/rank/getHotRank",data:{room_id:e,ruid:a,is_pre:t,area_id:i,page_size:r,source:o}}),getInfoByRoom:e=>BAPI.ajax({url:"xlive/web-room/v1/index/getInfoByRoom",data:{room_id:e}}),anchor:{check:e=>BAPI.ajax({url:"xlive/lottery-interface/v1/Anchor/Check?roomid="+e}),join:(e,a,t,i="pc")=>{var r={id:e,platform:i};return void 0!==a&&void 0!==t&&(r.gift_id=a,r.gift_num=t),BAPI.ajaxWithCommonArgs({method:"POST",url:"xlive/lottery-interface/v1/Anchor/Join",data:r})},randTime:e=>BAPI.ajax({url:"xlive/lottery-interface/v1/Anchor/RandTime?id="+e})}},YearWelfare:{checkFirstCharge:()=>BAPI.ajax({url:"YearWelfare/checkFirstCharge"}),inviteUserList:()=>BAPI.ajax({url:"YearWelfare/inviteUserList/1"})},DanmuWebSocket:class extends WebSocket{static stringToUint(e){const a=e.split(""),t=[];for(var i=0;i<a.length;++i)t.push(a[i].charCodeAt(0));return new Uint8Array(t)}static uintToString(e){return decodeURIComponent(escape(String.fromCharCode.apply(null,e)))}constructor(e,a,t,i){let r="wss://broadcastlv.chat.bilibili.com/sub";if(Array.isArray(t)&&t.length>0){let e=!1;do{const a=t.shift();a.wss_port?r=`wss://${a.host}:${a.wss_port}/sub`:e=!0}while(e&&t.length>0)}else"string"==typeof t&&t.length>0&&(r=t);super(r),this.binaryType="arraybuffer",this.handlers={reconnect:[],login:[],heartbeat:[],cmd:[],receive:[]},this.host_server_list=t,this.token=i,this.closed=!1,this.addEventListener("open",(()=>{this.sendLoginPacket(e,a).sendHeartBeatPacket(),this.heartBeatHandler=setInterval((()=>{this.sendHeartBeatPacket()}),3e4)})),this.addEventListener("close",(()=>{this.heartBeatHandler&&clearInterval(this.heartBeatHandler),this.closed||setTimeout((()=>{const t=new BAPI.DanmuWebSocket(e,a,this.host_server_list,this.token);t.handlers=this.handlers,t.unzip=this.unzip;for(const e in this.handlers)this.handlers.hasOwnProperty(e)&&this.handlers[e].forEach((a=>{switch(e){case"reconnect":t.addEventListener("reconnect",(e=>{a.call(t,e.detail.ws)}));break;case"login":t.addEventListener("login",(()=>{a.call(t)}));break;case"heartbeat":t.addEventListener("heartbeat",(e=>{a.call(t,e.detail.num)}));break;case"cmd":t.addEventListener("cmd",(e=>{a.call(t,e.detail.obj,e.detail.str)}));break;case"receive":t.addEventListener("receive",(e=>{a.call(t,e.detail.len,e.detail.headerLen,e.detail.protover,e.detail.operation,e.detail.sequence,e.detail.data)}));break}}));this.dispatchEvent(new CustomEvent("reconnect",{detail:{ws:t}}))}),1e4)})),this.addEventListener("message",(e=>{const a=new DataView(e.data);let t=0;for(let i=0;i<e.data.byteLength;i+=t){t=a.getUint32(i);const r=a.getUint16(i+4),o=a.getUint16(i+6),n=a.getUint32(i+8),l=a.getUint32(i+12);let s=e.data.slice(i+r,i+t);if(2===o&&this.unzip&&(s=this.unzip(s)),this.dispatchEvent(new CustomEvent("receive",{detail:{len:t,headerLen:r,protover:o,operation:n,sequence:l,data:s}})),2===o&&!this.unzip)continue;const d=new DataView(s);switch(n){case 3:{const e=d.getUint32(0);this.dispatchEvent(new CustomEvent("heartbeat",{detail:{num:e}}));break}case 5:{const e=BAPI.DanmuWebSocket.uintToString(new Uint8Array(s)),a=JSON.parse(e);this.dispatchEvent(new CustomEvent("cmd",{detail:{obj:a,str:e}}));break}case 8:this.dispatchEvent(new CustomEvent("login"));break}}}))}close(e,a){this.closed=!0,super.close(e,a)}setUnzip(e){this.unzip=e}bind(e,a,t,i,r){"function"==typeof e&&(this.addEventListener("reconnect",(a=>{e.call(this,a.detail.ws)})),this.handlers.reconnect.push(e)),"function"==typeof a&&(this.addEventListener("login",(()=>{a.call(this)})),this.handlers.login.push(a)),"function"==typeof t&&(this.addEventListener("heartbeat",(e=>{t.call(this,e.detail.num)})),this.handlers.heartbeat.push(t)),"function"==typeof i&&(this.addEventListener("cmd",(e=>{i.call(this,e.detail.obj,e.detail.str)})),this.handlers.cmd.push(i)),"function"==typeof r&&(this.addEventListener("receive",(e=>{r.call(this,e.detail.len,e.detail.headerLen,e.detail.protover,e.detail.operation,e.detail.sequence,e.detail.data)})),this.handlers.receive.push(r))}sendData(e,a,t,i){if(this.readyState!==WebSocket.OPEN)throw new Error("DanmuWebSocket未连接");switch(Object.prototype.toString.call(e)){case"[object Object]":return this.sendData(JSON.stringify(e),a,t,i);case"[object String]":{let r=BAPI.DanmuWebSocket.stringToUint(e),o=new ArrayBuffer(BAPI.DanmuWebSocket.headerLength+r.byteLength),n=new DataView(o);n.setUint32(0,BAPI.DanmuWebSocket.headerLength+r.byteLength),n.setUint16(4,BAPI.DanmuWebSocket.headerLength),n.setUint16(6,parseInt(a,10)),n.setUint32(8,parseInt(t,10)),n.setUint32(12,parseInt(i,10));for(let e=0;e<r.byteLength;++e)n.setUint8(BAPI.DanmuWebSocket.headerLength+e,r[e]);this.send(o)}return this;default:this.send(e)}return this}sendLoginPacket(e,a){const t={uid:parseInt(e,10),roomid:parseInt(a,10),protover:2,platform:"web",clientver:"1.8.5",type:2,key:this.token};return this.sendData(t,1,7,1)}sendHeartBeatPacket(){return this.sendData("[object Object]",1,2,1)}},sendLiveDanmu:(e,a,t="16777215",i="25",r="1",o="0")=>BAPI.ajaxWithCommonArgs({method:"POST",url:"msg/send",data:{color:t,fontsize:i,mode:r,msg:e,rnd:BAPI_ts_s(),roomid:a,bubble:o}}),sendMsg:(e,a=0,t="web")=>BAPI.ajaxWithCommonArgs({method:"POST",url:"//api.vc.bilibili.com/web_im/v1/web_im/send_msg ",data:{"msg[sender_uid]":e.sender_uid,"msg[receiver_id]":e.receiver_id,"msg[receiver_type]":e.receiver_type||1,"msg[msg_type]":e.msg_type||1,"msg[msg_status]":e.msg_status||0,"msg[content]":e.content,"msg[timestamp]":BAPI_ts_s(),"msg[dev_id]":e.dev_id,build:a,mobi_app:t}}),getCookie:e=>{let a,t=document.cookie.split(";");for(var i=0;i<t.length;i++)if(a=t[i].split("="),a[0].replace(" ","")==e)return decodeURIComponent(a[1])},KeySign:{sort:e=>{let a=Object.keys(e).sort(),t=[];for(let i of a)t.push(`${i}=${e[i]}`);return t.join("&")}}};BAPI.DanmuWebSocket.headerLength=16;